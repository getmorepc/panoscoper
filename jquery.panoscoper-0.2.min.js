(function($){$.fn.extend({panoscope:function(optPano,optCompass){this.each(function(){var setPano={cursors:true,debug:false,width:$(this).outerHeight()/3*4,height:$(this).outerHeight(),direction:0,momentum:80};var setCompass={enabled:true,url:'compass.png',width:100,height:100,bearing:0};if(optPano){var setPano=$.extend(setPano,optPano);}
if(optCompass){var setCompass=$.extend(setCompass,optCompass);}
var panowrap='<div id="'+$(this).attr('id')+'-frame" class="panoframe"><div id="'+$(this).attr('id')+'-viewer" class="panoviewer"><div id="'+$(this).attr('id')+'-box" class="panobox">';$(this).attr('id',$(this).attr('id')).attr('unselectable','on').css('-moz-user-select','none').css('-webkit-user-select','none').css('margin','0').css('float','left').css('display','block').wrap(panowrap).clone().attr('id',$(this).attr('id')+'-clone').insertAfter($(this));var pano=$(this);var panobox=$(this).parent();var boxwidth=$(this).outerWidth()*2;panobox.width(boxwidth).css('marginLeft',-setPano.direction+'px');var panoviewer=panobox.parent();panoviewer.css('height','100%').css('width','100%').css('display','block').css('overflow','hidden');if(setCompass.enabled){var compassimg='<img id="'+$(this).attr('id')+'-compass" class="panocompass" src="'+setCompass.url+'" alt="compass" width="'+setCompass.width+'" height="'+setCompass.height+'" style="position:absolute;" />';panoviewer.before(compassimg);var panocompass=$('#'+$(this).attr('id')+'-compass');}
if(setPano.debug){var debugbox='<div id="'+$(this).attr('id')+'-debugger" class="panodebug" style="float:right; position:absolute; background:black; color:white; padding:5px;">N/A</div>';console.log('Debugger is now online');panoviewer.before(debugbox);var panodebug=$('#'+$(this).attr('id')+'-debugger');}
var panoframe=panoviewer.parent();panoframe.css('height',setPano.height).css('width',setPano.width).css('clear','both').css('overflow','hidden');var pagepos=panoframe.offset();var xmov;var interAnim;updateCompass(setPano.direction);panoframe.mouseenter(function(e){interAnim=setInterval(function(){updatepano();},20);});panoframe.mouseleave(function(e){clearInterval(interAnim);cursorupdate(0);});panoframe.mousemove(function(e){xmov=e.pageX-((setPano.width/2)+pagepos.left);if(pano.height()>setPano.height){ymov=e.pageY-((setPano.height/2)+pagepos.top);panoviewer}});function updatepano(){var currentMarg=parseInt(panobox.css('marginLeft'),10);var amountToMove=currentMarg-(xmov/setPano.momentum);if(amountToMove>=0){panobox.css('marginLeft',currentMarg-pano.width());if(setPano.debug){console.log('jumped left');}}
else if(amountToMove<=-boxwidth+setPano.width){panobox.css('marginLeft',currentMarg+pano.width());if(setPano.debug){console.log('jumped right');}}
currentMarg=parseInt(panobox.css('marginLeft'),10);amountToMove=Math.round(currentMarg-(xmov/setPano.momentum));if(setPano.cursors){if(xmov<0&&amountToMove!==currentMarg){cursorupdate(1);}else if(xmov>0&&amountToMove!==currentMarg){cursorupdate(2);}else{cursorupdate(0);}}
if(setCompass.enabled){updateCompass(amountToMove);}
panobox.css('marginLeft',amountToMove+'px');}
function updateCompass(marg){var panorot=((marg+setCompass.bearing)/pano.width())*360;panorot=panorot%360;panocompass.css({'-webkit-transform':'rotate('+panorot+'deg) ','-moz-transform':'rotate('+panorot+'deg)'});if(setPano.debug){panodebug.html('Current Bearing: '+(-marg)+'<br/>North: '+setCompass.bearing);}}
function cursorupdate(num){switch(num){case 1:if(panoframe.css('cursor')!=='w-resize'){panoframe.css('cursor','w-resize');}
break;case 2:if(panoframe.css('cursor')!=='e-resize'){panoframe.css('cursor','e-resize');}
break;default:if(panoframe.css('cursor')!=='default'){panoframe.css('cursor','default');}
break;}}});}});})(jQuery);